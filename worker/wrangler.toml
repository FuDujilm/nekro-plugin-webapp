# Cloudflare Worker 配置文件

name = "webapp-deploy"
main = "src/index.ts"
compatibility_date = "2024-01-01"

# Worker 类型
workers_dev = true

# D1 数据库绑定
# ⚠️ 重要：请将 database_id 替换为你在 Cloudflare 创建的数据库 ID
[[d1_databases]]
binding = "DB"
database_name = "nekro-webapp-db"
database_id = "7dc7d83a-e890-42d5-9344-0ab64b5525e1" # 请替换为你的 Database ID

# 环境变量
[vars]
# 数据库初始化标志（Worker 首次运行时自动初始化）
DB_INITIALIZED = "false"

# 4) 环境变量（可把允许的 CORS 源配置在此，便于多环境差异化）
# 你现在在代码里是常量 Set，如果想改为 ENV 驱动，可以把
# ALLOW_ORIGINS 配置成逗号分隔字符串，在 Worker 中 parse：
# const origins = (env.ALLOW_ORIGINS || "").split(",").map(s=>s.trim())
ALLOW_ORIGINS = "https://webapp.nc.mzyd.work,https://nc.mzyd.work,http://192.168.31.187:8021,http://localhost:8021,http://localhost:5173"

# 可选：切换是否允许携带凭据
CORS_ALLOW_CREDENTIALS = "true"

# -------- per-env 配置（本地/开发/生产差异）--------
# 本地开发（wrangler dev 默认使用）
[dev]
ip = "0.0.0.0"
port = 8787
local_protocol = "http"

# 你也可以为不同 env 定义不同变量/路由：
[env.dev]
# 仅用于开发的变量覆盖
[env.dev.vars]
ALLOW_ORIGINS = "http://192.168.31.187:8021,http://localhost:8021,http://localhost:5173"

# 若需要把 dev 环境同样绑定到子域（一般不建议），可以在 dev 环境再配 routes：
# [env.dev]
# routes = [
#   { pattern = "dev-webapp.nc.mzyd.work/*", zone_name = "nc.mzyd.work" }
# ]

[env.prod]
# 生产环境的变量覆盖
[env.prod.vars]
ALLOW_ORIGINS = "https://webapp.nc.mzyd.work,http://192.168.31.187:8021"
CORS_ALLOW_CREDENTIALS = "true"

# 生产环境路由（如需与默认 routes 不同，可在此覆写/追加）
# [env.prod]
# routes = [
#   { pattern = "webapp.nc.mzyd.work/*", zone_name = "nc.mzyd.work" }
# ]
